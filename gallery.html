<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì–∞–ª–µ—Ä–µ—è 3D —Ç–µ–ª</title>
    <link rel="stylesheet" href="style.css">
    <!-- ==================== –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï THREE.JS ==================== -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <!-- ==================== –î–õ–Ø –ó–ê–ì–†–£–ó–ö–ò .GLB –§–ê–ô–õ–û–í ==================== -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
</head>
<body>
    <!-- ==================== –®–ê–ü–ö–ê –°–ê–ô–¢–ê ==================== -->
    <header class="header">
        <div class="container">
             <div class="logo-container">
                 <img src="pict/logo.png" alt="3D Geometry Logo" class="logo-image">
                 <h1 class="logo">3D Geometry</h1>
             </div>
            <nav class="nav">
                <a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a>
                <a href="gallery.html" class="active">–ì–∞–ª–µ—Ä–µ—è</a>
                <a href="formulas.html">–§–∏–≥—É—Ä—ã</a>
                <a href="about.html">–û –ø—Ä–æ–µ–∫—Ç–µ</a>
            </nav>
        </div>
    </header>

    <main class="main">
        <div class="container">
            <h2>–ì–∞–ª–µ—Ä–µ—è –≥–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏—Ö —Ç–µ–ª</h2>
            <p>–ò—Å—Å–ª–µ–¥—É–π—Ç–µ –∫–æ–ª–ª–µ–∫—Ü–∏—é —Ç—Ä–µ—Ö–º–µ—Ä–Ω—ã—Ö –≥–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏—Ö —Ñ–∏–≥—É—Ä. </p>
            <p>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –ª—é–±—É—é –∫–∞—Ä—Ç–æ—á–∫—É –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ 3D –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –≤—Ä–∞—â–µ–Ω–∏—è –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è.</p> 
            
            <!-- ==================== –ì–ê–õ–ï–†–ï–Ø –§–ò–ì–£–† ==================== -->
            <div class="gallery-grid">
                <!-- –§–∏–≥—É—Ä–∞ 0: –ö—É–± -->
                <div class="gallery-card" data-shape="0">
                    <h3>–ö—É–±</h3>
                    <div class="card-image">
                        <img src="pict/kub.png" alt="–ö—É–±" class="shape-image">
                    </div>
                </div>

                <!-- –§–∏–≥—É—Ä–∞ 1: –ü–∞—Ä–∞–ª–ª–µ–ª–µ–ø–∏–ø–µ–¥ -->
                <div class="gallery-card" data-shape="1">
                    <h3>–ü–∞—Ä–∞–ª–ª–µ–ª–µ–ø–∏–ø–µ–¥</h3>
                    <div class="card-image">
                        <img src="pict/par.png" alt="–ü–∞—Ä–∞–ª–ª–µ–ª–µ–ø–∏–ø–µ–¥" class="shape-image">
                    </div>
                </div>
                
                <!-- –§–∏–≥—É—Ä–∞ 2: –¶–∏–ª–∏–Ω–¥—Ä -->
                <div class="gallery-card" data-shape="2">
                    <h3>–¶–∏–ª–∏–Ω–¥—Ä</h3>
                    <div class="card-image">
                        <img src="pict/cyl.png" alt="–¶–∏–ª–∏–Ω–¥—Ä" class="shape-image">
                    </div>
                </div>
                
                <!-- –§–∏–≥—É—Ä–∞ 3: –ü–∏—Ä–∞–º–∏–¥–∞ -->
                <div class="gallery-card" data-shape="3">
                    <h3>–ü–∏—Ä–∞–º–∏–¥–∞</h3>
                    <div class="card-image">
                        <img src="pict/pir.png" alt="–ü–∏—Ä–∞–º–∏–¥–∞" class="shape-image">
                    </div>
                </div>

                <!-- –§–∏–≥—É—Ä–∞ 4: –ö–æ–Ω—É—Å -->
                <div class="gallery-card" data-shape="4">
                    <h3>–ö–æ–Ω—É—Å</h3>
                    <div class="card-image">
                        <img src="pict/cons.png" alt="–ö–æ–Ω—É—Å" class="shape-image">
                    </div>
                </div>

                <!-- –§–∏–≥—É—Ä–∞ 5: –°—Ñ–µ—Ä–∞ -->
                <div class="gallery-card" data-shape="5">
                    <h3>–°—Ñ–µ—Ä–∞</h3>
                    <div class="card-image">
                        <img src="pict/sfer.png" alt="–°—Ñ–µ—Ä–∞" class="shape-image">
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- ==================== –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û 3D –ü–†–û–°–ú–û–¢–†–ê ==================== -->
    <div id="modal-viewer" class="modal-viewer hidden">
        <div class="modal-header">
            <div class="model-info">
                <span id="current-model-name">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∏–≥—É—Ä—É</span>
            </div>
            <div class="controls-info">
                <span>üñ±Ô∏è –õ–ö–ú - –≤—Ä–∞—â–µ–Ω–∏–µ | üñ±Ô∏è –ü–ö–ú - –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ | üñ±Ô∏è –ö–æ–ª–µ—Å–æ - –º–∞—Å—à—Ç–∞–±</span>
            </div>
            <button id="close-modal" class="close-modal-btn">‚úï –ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
        <div id="modal-viewer-content" class="modal-viewer-content"></div>
        <div id="loading-indicator" class="loading-indicator hidden">
            <div class="loading-spinner"></div>
            <p>–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏...</p>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 3D Geometry Project</p>
        </div>
    </footer>

    <script>
        // ==================== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø 3D –§–ò–ì–£–† ====================
        const shapesConfig = {
            '0': { 
                type: 'glb',
                path: 'models/cube.glb',
                name: '–ö—É–±'
            },
            '1': {
                type: 'glb',
                path: 'models/parallelepiped.glb',
                name: '–ü–∞—Ä–∞–ª–ª–µ–ª–µ–ø–∏–ø–µ–¥'
            },
            '2': { 
                type: 'glb',
                path: 'models/cylinder.glb',
                name: '–¶–∏–ª–∏–Ω–¥—Ä'
            },
            '3': { 
                type: 'glb',
                path: 'models/pyramid.glb',
                name: '–ü–∏—Ä–∞–º–∏–¥–∞'
            },
            '4': { 
                type: 'glb',
                path: 'models/cone.glb',
                name: '–ö–æ–Ω—É—Å'
            },
            '5': { 
                type: 'glb',
                path: 'models/sphere.glb',
                name: '–°—Ñ–µ—Ä–∞'
            }
        };

        // ==================== –û–¢–õ–ê–î–û–ß–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø ====================
        console.log('=== 3D Gallery Debug Info ===');
        console.log('GLTFLoader available:', typeof THREE.GLTFLoader !== 'undefined');
        console.log('Shapes config:', shapesConfig);
        console.log('Three.js version:', THREE.REVISION);

        // ==================== –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò –≠–õ–ï–ú–ï–ù–¢–´ DOM ====================
        const modalViewer = document.getElementById('modal-viewer');
        const modalViewerContent = document.getElementById('modal-viewer-content');
        const closeModalBtn = document.getElementById('close-modal');
        const galleryCards = document.querySelectorAll('.gallery-card');

        // Three.js –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let scene, camera, renderer, controls, currentMesh;

        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø 3D –°–¶–ï–ù–´ ====================
        function init3DViewer() {
            if (scene) return; // –£–∂–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞

            try {
                // –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ü–µ–Ω—ã
                scene = new THREE.Scene();
                
                // ==================== –ì–†–ê–î–ò–ï–ù–¢–ù–´–ô –§–û–ù ====================
                const canvas = document.createElement('canvas');
                canvas.width = 32;
                canvas.height = 32;
                const context = canvas.getContext('2d');
                
                const gradient = context.createLinearGradient(0, 0, 0, 32);
                gradient.addColorStop(0, '#e8f4f8');  // –°–≤–µ—Ç–ª–æ-–≥–æ–ª—É–±–æ–π
                gradient.addColorStop(1, '#f0f0f0');  // –°–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π
                
                context.fillStyle = gradient;
                context.fillRect(0, 0, 32, 32);
                
                const texture = new THREE.CanvasTexture(canvas);
                scene.background = texture;

                // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–∞–º–µ—Ä—ã
                camera = new THREE.PerspectiveCamera(75, modalViewerContent.clientWidth / modalViewerContent.clientHeight, 0.1, 1000);
                camera.position.z = 5;

                // –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–Ω–¥–µ—Ä–µ—Ä–∞
                renderer = new THREE.WebGLRenderer({ 
                    antialias: true,
                    alpha: true 
                });
                renderer.setSize(modalViewerContent.clientWidth, modalViewerContent.clientHeight);
                renderer.setClearColor(0x000000, 0);
                modalViewerContent.innerHTML = '';
                modalViewerContent.appendChild(renderer.domElement);

                // ==================== –û–°–í–ï–©–ï–ù–ò–ï –°–¶–ï–ù–´ ====================
                const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
                scene.add(ambientLight);

                const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
                directionalLight.position.set(5, 5, 5);
                scene.add(directionalLight);

                const backLight = new THREE.DirectionalLight(0xffffff, 0.4);
                backLight.position.set(-5, -5, -5);
                scene.add(backLight);

                // ==================== –ù–ê–°–¢–†–û–ô–ö–ê –£–ü–†–ê–í–õ–ï–ù–ò–Ø ====================
                controls = new THREE.OrbitControls(camera, renderer.domElement);
                controls.enableDamping = true;
                controls.dampingFactor = 0.05;

                // ==================== –§–£–ù–ö–¶–ò–Ø –ê–ù–ò–ú–ê–¶–ò–ò ====================
                function animate() {
                    requestAnimationFrame(animate);
                    controls.update();
                    renderer.render(scene, camera);
                }
                animate();

                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
                window.addEventListener('resize', onWindowResize);

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ 3D –ø—Ä–æ—Å–º–æ—Ç—Ä—â–∏–∫–∞:', error);
                modalViewerContent.innerHTML = '<div class="error-message">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ 3D –ø—Ä–æ—Å–º–æ—Ç—Ä—â–∏–∫–∞</div>';
            }
        }

        // ==================== –û–ë–†–ê–ë–û–¢–ö–ê –ò–ó–ú–ï–ù–ï–ù–ò–Ø –†–ê–ó–ú–ï–†–ê –û–ö–ù–ê ====================
        function onWindowResize() {
            if (camera && renderer && modalViewerContent.clientWidth > 0 && modalViewerContent.clientHeight > 0) {
                camera.aspect = modalViewerContent.clientWidth / modalViewerContent.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(modalViewerContent.clientWidth, modalViewerContent.clientHeight);
            }
        }

        // ==================== –°–û–ó–î–ê–ù–ò–ï 3D –§–ò–ì–£–† ====================
        function createShape(shapeId) {
            if (!scene) return;

            // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â—É—é —Ñ–∏–≥—É—Ä—É
            if (currentMesh) {
                scene.remove(currentMesh);
                cleanupMesh(currentMesh);
            }

            const config = shapesConfig[shapeId];
            if (!config) {
                console.error('–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è —Ñ–∏–≥—É—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω–∞:', shapeId);
                return;
            }

            // –ó–∞–≥—Ä—É–∂–∞–µ–º GLB –º–æ–¥–µ–ª—å
            loadGLBModel(config.path, config);
        }

        // ==================== –ó–ê–ì–†–£–ó–ö–ê .GLB –ú–û–î–ï–õ–ò ====================
        function loadGLBModel(modelPath, config) {
            console.log(`üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ GLB –º–æ–¥–µ–ª–∏: ${config.name} –∏–∑ ${modelPath}`);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
            showLoadingIndicator(true);
            
            const loader = new THREE.GLTFLoader();
            
            loader.load(
                modelPath,
                // onLoad callback
                (gltf) => {
                    showLoadingIndicator(false);
                    
                    // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â—É—é –º–æ–¥–µ–ª—å
                    if (currentMesh) {
                        scene.remove(currentMesh);
                        cleanupMesh(currentMesh);
                    }
                    
                    currentMesh = gltf.scene;
                    
                    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
                    scaleModelToFit(currentMesh);
                    
                    // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
                    currentMesh.traverse((child) => {
                        if (child.isMesh) {
                            child.castShadow = true;
                            child.receiveShadow = true;
                        }
                    });
                    
                    scene.add(currentMesh);
                    centerCameraOnObject(currentMesh);
                    updateModelName(config.name);
                    
                    console.log(`‚úÖ –ú–æ–¥–µ–ª—å "${config.name}" —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–∞`);
                },
                // onProgress callback
                (xhr) => {
                    const percentLoaded = xhr.loaded / xhr.total * 100;
                    console.log(`${config.name}: ${percentLoaded.toFixed(1)}% –∑–∞–≥—Ä—É–∂–µ–Ω–æ`);
                },
                // onError callback
                (error) => {
                    showLoadingIndicator(false);
                    console.error(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ GLB ${config.name}:`, error);
                    // –°–æ–∑–¥–∞–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—É—é —Ñ–∏–≥—É—Ä—É
                    createFallbackShape(config);
                }
            );
        }

        // ==================== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ====================

        // –§—É–Ω–∫—Ü–∏—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–¥–µ–ª–∏
        function scaleModelToFit(object) {
            const box = new THREE.Box3().setFromObject(object);
            const size = box.getSize(new THREE.Vector3());
            const maxSize = Math.max(size.x, size.y, size.z);
            
            // –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º —Ç–∞–∫, —á—Ç–æ–±—ã –Ω–∞–∏–±–æ–ª—å—à–∏–π —Ä–∞–∑–º–µ—Ä –±—ã–ª ~2 –µ–¥–∏–Ω–∏—Ü—ã
            const targetSize = 2;
            const scale = targetSize / maxSize;
            object.scale.set(scale, scale, scale);
        }

        // –§—É–Ω–∫—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏ –º–µ—à–∞
        function cleanupMesh(mesh) {
            if (!mesh) return;
            
            mesh.traverse((child) => {
                if (child.isMesh) {
                    if (child.geometry) child.geometry.dispose();
                    if (child.material) {
                        if (Array.isArray(child.material)) {
                            child.material.forEach(material => material.dispose());
                        } else {
                            child.material.dispose();
                        }
                    }
                }
            });
        }

        // –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–π —Ñ–∏–≥—É—Ä—ã
        function createFallbackShape(config) {
            console.log(`–°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π —Ñ–∏–≥—É—Ä—ã: ${config.name}`);
            
            let geometry;
            const colors = {
                '–ö—É–±': 0x3498db,
                '–ü–∞—Ä–∞–ª–ª–µ–ª–µ–ø–∏–ø–µ–¥': 0xe74c3c,
                '–¶–∏–ª–∏–Ω–¥—Ä': 0x2ecc71,
                '–ü–∏—Ä–∞–º–∏–¥–∞': 0x9b59b6,
                '–ö–æ–Ω—É—Å': 0xf39c12,
                '–°—Ñ–µ—Ä–∞': 0x1abc9c
            };
            
            const color = colors[config.name] || 0x3498db;
            
            try {
                switch (config.name) {
                    case '–ö—É–±':
                        geometry = new THREE.BoxGeometry(2, 2, 2);
                        break;
                    case '–ü–∞—Ä–∞–ª–ª–µ–ª–µ–ø–∏–ø–µ–¥':
                        geometry = new THREE.BoxGeometry(3, 2, 1.5);
                        break;
                    case '–¶–∏–ª–∏–Ω–¥—Ä':
                        geometry = new THREE.CylinderGeometry(1, 1, 3, 32);
                        break;
                    case '–ü–∏—Ä–∞–º–∏–¥–∞':
                        geometry = new THREE.ConeGeometry(1.2, 2, 4);
                        break;
                    case '–ö–æ–Ω—É—Å':
                        geometry = new THREE.ConeGeometry(1.2, 3, 32);
                        break;
                    case '–°—Ñ–µ—Ä–∞':
                        geometry = new THREE.SphereGeometry(1.5, 32, 32);
                        break;
                    default:
                        geometry = new THREE.BoxGeometry(2, 2, 2);
                }

                const material = new THREE.MeshPhongMaterial({ 
                    color: color,
                    shininess: 80,
                    specular: 0x444444,
                    transparent: true,
                    opacity: 0.95
                });

                currentMesh = new THREE.Mesh(geometry, material);
                scene.add(currentMesh);
                centerCameraOnObject(currentMesh);
                updateModelName(config.name + " (—Ä–µ–∑–µ—Ä–≤–Ω–∞—è)");

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–π —Ñ–∏–≥—É—Ä—ã:', error);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤
        async function checkModelFiles() {
            console.log('=== –ü—Ä–æ–≤–µ—Ä–∫–∞ GLB —Ñ–∞–π–ª–æ–≤ –º–æ–¥–µ–ª–µ–π ===');
            
            for (const [key, config] of Object.entries(shapesConfig)) {
                try {
                    const response = await fetch(config.path);
                    console.log(`üìÅ ${config.name} (${config.path}): ${response.ok ? '‚úÖ –ù–ê–ô–î–ï–ù' : '‚ùå –ù–ï –ù–ê–ô–î–ï–ù'}`);
                } catch (error) {
                    console.log(`‚ùå ${config.name}: –û—à–∏–±–∫–∞ - ${error.message}`);
                }
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è UI
        function showLoadingIndicator(show) {
            const indicator = document.getElementById('loading-indicator');
            if (indicator) {
                indicator.classList.toggle('hidden', !show);
            }
        }

        function updateModelName(name) {
            const nameElement = document.getElementById('current-model-name');
            if (nameElement) {
                nameElement.textContent = name;
            }
        }

        // ==================== –¶–ï–ù–¢–†–ò–†–û–í–ê–ù–ò–ï –ö–ê–ú–ï–†–´ –ù–ê –û–ë–™–ï–ö–¢–ï ====================
        function centerCameraOnObject(object) {
            const box = new THREE.Box3().setFromObject(object);
            const center = box.getCenter(new THREE.Vector3());
            const size = box.getSize(new THREE.Vector3());
            
            const maxDim = Math.max(size.x, size.y, size.z);
            const fov = camera.fov * (Math.PI / 180);
            let cameraZ = Math.abs(maxDim / Math.sin(fov / 2));
            
            cameraZ *= 1.5; // –û—Ç—Å—Ç—É–ø –æ—Ç –æ–±—ä–µ–∫—Ç–∞
            
            camera.position.set(center.x, center.y, center.z + cameraZ);
            controls.target.set(center.x, center.y, center.z);
            controls.update();
        }

        // ==================== –£–ü–†–ê–í–õ–ï–ù–ò–ï –ú–û–î–ê–õ–¨–ù–´–ú –û–ö–ù–û–ú ====================
        function showModalViewer(shapeId) {
            if (!shapesConfig[shapeId]) return;

            modalViewer.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            
            if (!scene) {
                init3DViewer();
            }
            
            // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏
            requestAnimationFrame(() => {
                createShape(shapeId);
                onWindowResize();
            });
        }

        function hideModalViewer() {
            modalViewer.classList.add('hidden');
            document.body.style.overflow = '';
        }

        // ==================== –ù–ê–°–¢–†–û–ô–ö–ê –û–ë–†–ê–ë–û–¢–ß–ò–ö–û–í –°–û–ë–´–¢–ò–ô ====================
        function setupEventListeners() {
            // –ö–ª–∏–∫ –ø–æ –∫–∞—Ä—Ç–æ—á–∫–µ —Ñ–∏–≥—É—Ä—ã
            galleryCards.forEach(card => {
                card.addEventListener('click', () => {
                    const shapeId = card.dataset.shape;
                    showModalViewer(shapeId);
                });
            });

            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            closeModalBtn.addEventListener('click', hideModalViewer);

            // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∞–≤–∏—à–µ ESC
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && !modalViewer.classList.contains('hidden')) {
                    hideModalViewer();
                }
            });

            // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –Ω–∞ –∑–∞—Ç–µ–º–Ω–µ–Ω–Ω—É—é –æ–±–ª–∞—Å—Ç—å
            modalViewer.addEventListener('click', (e) => {
                if (e.target === modalViewer) {
                    hideModalViewer();
                }
            });
        }

        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–†–ò –ó–ê–ì–†–£–ó–ö–ï ====================
        document.addEventListener('DOMContentLoaded', () => {
            setupEventListeners();
            checkModelFiles();
        });

        // ==================== –û–ß–ò–°–¢–ö–ê –†–ï–°–£–†–°–û–í ====================
        window.addEventListener('beforeunload', () => {
            if (renderer) {
                renderer.dispose();
            }
            if (currentMesh) {
                cleanupMesh(currentMesh);
            }
        });
    </script>
</body>
</html>